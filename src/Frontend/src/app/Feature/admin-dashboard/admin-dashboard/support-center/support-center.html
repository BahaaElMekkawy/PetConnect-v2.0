<div class="container my-4">
  <h2 class="mb-3">Support Requests</h2>

  <!-- Toggle Filters -->
  <button
    class="btn btn-outline-primary mb-3"
    (click)="showFilters = !showFilters"
  >
    <i class="bi bi-funnel"></i> Filters
  </button>

  <!-- Filters -->
  <div *ngIf="showFilters" class="card p-3 mb-3 shadow-sm">
    <div class="row g-3 align-items-end">
      <!-- Username Filter -->
      <div class="col-md-5">
        <label class="form-label">Username</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="filters.username"
          name="username"
          placeholder="Search by username"
        />
      </div>

      <!-- Type Filter -->
      <div class="col-md-5">
        <label class="form-label">Type</label>
        <select class="form-select" [(ngModel)]="filters.type" name="type">
          <option value="">All Types</option>
          <option *ngFor="let t of requestTypes" [value]="t.key">
            {{ t.value }}
          </option>
        </select>
      </div>

      <!-- Status Filter -->
      <div class="col-md-5">
        <label class="form-label">Status</label>
        <select class="form-select" [(ngModel)]="filters.status" name="status">
          <option value="">All Statuses</option>
          <option *ngFor="let s of requestStatuses" [value]="s.key">
            {{ s.value }}
          </option>
        </select>
      </div>
      <!-- Priority Filter -->
      <div class="col-md-5">
        <label class="form-label">Priority</label>
        <select
          class="form-select"
          [(ngModel)]="filters.priority"
          name="priority"
        >
          <option value="">All Priorities</option>
          <option *ngFor="let p of requestPriorities" [value]="p.key">
            {{ p.value }}
          </option>
        </select>
      </div>
      <div class="col-12 d-flex gap-2">
        <button class="btn btn-primary" (click)="applyFilters()">Apply</button>
        <button class="btn btn-secondary" (click)="resetFilters()">
          Reset
        </button>
      </div>
    </div>
  </div>

  <!-- Tickets Table -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>User</th>
          <th>Type</th>
          <th>Status</th>
          <th>Priority</th>
          <!-- <th>Subject</th> -->
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let req of filteredRequests; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ req.userName }}</td>
          <td>
            <span
              class="badge"
              [ngClass]="getTypeBadgeClass(req.supportRequestType)"
            >
              {{ req.supportRequestType }}
            </span>
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="getStatusBadgeClass(req.supportRequestStatus)"
            >
              {{ req.supportRequestStatus }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="getPriorityBadgeClass(req.priority)">
              {{ req.priority }}
            </span>
          </td>
          <!-- <td>{{ req.subject }}</td> -->
          <td>
            <button
              class="btn btn-sm btn-outline-primary"
              (click)="viewTicket(req.id)"
            >
              Reply
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Reply Form -->
  <div *ngFor="let req of filteredRequests">
    <div *ngIf="replyFormVisible[req.id]" class="card p-3 mb-3 shadow-sm">
      <h5>Reply to {{ req.userName }}</h5>
      <div class="mb-2">
        <input
          type="text"
          class="form-control"
          placeholder="Subject"
          [(ngModel)]="replyData[req.id].subject"
        />
      </div>
      <div class="mb-2">
        <textarea
          class="form-control"
          placeholder="Message"
          [(ngModel)]="replyData[req.id].message"
        ></textarea>
      </div>
      <div class="mb-2">
        <select class="form-select" [(ngModel)]="replyData[req.id].status">
          <option *ngFor="let s of requestStatuses" [value]="s.key">
            {{ s.value }}
          </option>
        </select>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-success" (click)="sendReply(req.id)">
          Send
        </button>
        <button class="btn btn-secondary" (click)="toggleReplyForm(req.id)">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
