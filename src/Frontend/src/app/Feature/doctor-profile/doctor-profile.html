<div *ngIf="profileLoading()" class="container py-5">
  <div  class="text-center">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3">Loading doctor details...</p>
  </div>
</div>
@if(typeof doctor != 'string' && !errorFound && !profileLoading()) {
  <section id="hero" class="hero section pb-0">
    <div class="container section-title aos-init aos-animate pb-0" data-aos="fade-up">
      <h2>Our Vets</h2>
      <h3>Dr. {{ doctor.fName }}</h3>
    </div>
  </section>

  <!-- <section id="doctor-profile" class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <img
            src="{{ server }}{{ doctor.imgUrl }}"
            class="img-fluid rounded"
            alt="{{ doctor.fName }}'s photo"
          />
        </div>
        <div class="col-md-8">
          <h3 class="mb-4">Dr. {{ doctor.fName }} {{ doctor.lName }}</h3>
          <p><strong>Specialty:</strong> {{ doctor.petSpecialty }}</p>
          <p><strong>Gender:</strong> {{ doctor.gender }}</p>
          <p><strong>Price Per Hour:</strong> {{ doctor.pricePerHour | currency: 'EGP': true }}</p>
          <p>
            <strong>Certificate:</strong>
            <a [href]="doctor.certificateUrl" target="_blank">View Certificate</a>
          </p>
          <p><strong>Address:</strong> {{ doctor.street }}, {{ doctor.city }}</p>
          <a href="#" class="btn btn-primary mt-3">Book Appointment</a><br />
          <a [routerLink]="['/doctors', 'update', doctor.id]" class="btn btn-primary mt-3">Update Profile</a>
        </div>
      </div>
    </div>
  </section> -->

  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">

        <!-- Doctor Profile Card -->
        <div class="card p-4 mb-5">
          <div class="row align-items-center">
            <div class="col-md-3 text-center">
              <img src="{{ server }}{{ doctor.imgUrl }}" alt="Doctor's Profile Picture" class="profile-image mb-3" />
            </div>
            <div class="col-md-9">
          <h3 class="mb-4">Dr. {{ doctor.fName }} {{ doctor.lName }}</h3>
          <p><strong>Pet Specialty:</strong> {{ doctor.petSpecialty }}</p>
          <p><strong>Gender:</strong> {{ doctor.gender }}</p>
          <p><strong>Price Per Hour:</strong> {{ doctor.pricePerHour | currency: 'EGP': true }}</p>
          <p>
            <strong>Certificate:</strong>
            <a [href]="doctor.certificateUrl" target="_blank">View Certificate</a>
          </p>
          <p><strong>Address:</strong> {{ doctor.street }}, {{ doctor.city }}</p>
            </div>
          </div>
        </div>

        <!-- Appointment Booking Section -->
        <div class="card p-4">
          <h3 class="mb-4 text-center text-primary">Book an Appointment</h3>

          <!-- Message Display -->
          @if(message) {
            <div class="alert alert-{{ messageType }} alert-message mb-4" role="alert">
              {{ message }}
            </div>
          }

          <!-- Available Dates Section -->
          <h4 class="mb-3">Select a Date:</h4>
          <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3 mb-4">
            @for(date of availableDates; track date) {
              <div class="col">
                <div
                  class="card date-card text-center p-3"
                  [class.active]="isSelected(date)"
                  (click)="selectDate(date)"
                >
                  <h5 class="card-title mb-0">{{ doctorProfileService.getReadableDate(date) }}</h5>
                  <p class="card-text text-muted mb-0">{{ date | date: 'fullDate' }}</p>
                </div>
              </div>
            }
          </div>

          <!-- Time Slots Section -->
          <h4 class="mb-3">Available Time Slots for
            @if(selectedDate) {
              <!-- <span class="text-primary">{{ doctorProfileService.getReadableDate(selectedDate) }}</span> -->
              <span class="text-primary">{{ doctorProfileService.getReadableDate(selectedDate) }}</span>
            } @else {
              <span class="text-muted">(Please select a date)</span>
            }
          </h4>

          <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-2">
            @for(slot of getSlotsForSelectedDate(); track slot) {
              <div class="col">
                <button
                  class="btn time-slot-btn"
                  [ngClass]="{ 'btn-outline-primary': !CustomerHasThisAppointmentSlot(slot), 'btn-secondary': CustomerHasThisAppointmentSlot(slot) }"
                  [disabled]="CustomerHasThisAppointmentSlot(slot) || slot.isFull || !slot.isActive"
                  (click)="bookAppointment(slot)"
                >
                  {{ slot.startTime | date: 'shortTime' }} - {{ slot.endTime | date: 'shortTime' }}
                  @if(CustomerHasThisAppointmentSlot(slot)) {
                    <span class="badge bg-danger ms-2">{{slot.status}}</span>
                    <span *ngIf="slot.isFull" class="badge bg-danger ms-2">Closed</span>
                  }
                  @else{
                    <span class="badge bg-success ms-2">{{slot.status}}</span>
                    <span *ngIf="!slot.isFull " class="badge bg-success ms-2">Open</span>
                  }
                </button>
              </div>
            }

            @if(getSlotsForSelectedDate().length === 0 && selectedDate) {
              <div class="col-12">
                <p class="text-center text-muted">No time slots available for this date.</p>
              </div>
            }
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bookingModalLabel">Confirm Your Appointment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>You are about to book an appointment with <strong>Dr. {{ doctor.fName }} {{ doctor.lName }}</strong>.</p>
        <!-- <p>On <strong>{{ doctorProfileService.getReadableDate(selectedDate) }}</strong> at <strong>{{ selectedSlot?.startTime }} - {{ selectedSlot?.endTime }}</strong>.</p> -->

        <!-- <form (ngSubmit)="confirmBooking()"> -->
          <div class="mb-3">
            <label for="patientName" class="form-label">Your Name</label>
            <!-- <input type="text" class="form-control" id="patientName" [(ngModel)]="patientName" name="patientName" required> -->
          </div>
          <div class="mb-3">
            <label for="patientEmail" class="form-label">Your Email</label>
            <!-- <input type="email" class="form-control" id="patientEmail" [(ngModel)]="patientEmail" name="patientEmail" required> -->
          </div>
          <div class="mb-3">
            <label for="notes" class="form-label">Notes (Optional)</label>
            <!-- <textarea class="form-control" id="notes" [(ngModel)]="notes" name="notes" rows="3"></textarea> -->
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">Confirm Booking</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        <!-- </form> -->
      </div>
    </div>
  </div>
</div>
}
@else {
  <section id="hero" class="hero section pb-0">
    <div class="container section-title aos-init aos-animate pb-0" data-aos="fade-up">
      <h2>Our Vets</h2>
      <h3>Search for a Doctor</h3>
    </div>
  </section>
}
