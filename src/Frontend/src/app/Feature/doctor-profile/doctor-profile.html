<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Doctor Profile Card -->
            <div class="card p-4 mb-5" *ngIf="!profileLoading()">
                <div class="row align-items-center">
                    <div class="col-md-3 text-center">
                        <img *ngIf="typeof doctor !== 'string'" src="{{ server}}/{{ doctor.imgUrl }}" alt="Doctor's Profile Picture"
                            class="profile-image mb-3" />
                    </div>
                    <div class="col-md-9">
                        <ng-container *ngIf="typeof doctor !== 'string'">
                            <h3 class="mb-4">Dr. {{ doctor.fName }} {{ doctor.lName }}</h3>
                            <p><strong>Pet Specialty:</strong> {{ doctor.petSpecialty }}</p>
                            <p><strong>Gender:</strong> {{ doctor.gender }}</p>
                            <p><strong>Price Per Hour:</strong> {{ doctor.pricePerHour | currency: 'EGP': true }}</p>
                            <p>
                                <strong>Certificate:</strong>
                                <a [href]="doctor.certificateUrl" target="_blank">View Certificate</a>
                            </p>
                            <p><strong>Address:</strong> {{ doctor.street }}, {{ doctor.city }}</p>
                        </ng-container>
                    </div>
                </div>
            </div>

            <!-- Appointment Booking Section -->
            <div class="card p-4">
                <h3 class="mb-4 text-center text-primary">Book an Appointment</h3>

                <!-- Message Display -->
                <div class="alert alert-{{ messageType }} alert-message mb-4" role="alert" *ngIf="message">
                    {{ message }}
                </div>

                <!-- Loading Spinner for Dates -->
                <div *ngIf="loadingDates()" class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-3">Loading available dates...</p>
                </div>
                
                <!-- Available Dates Section -->
                <ng-container *ngIf="!loadingDates()">
                    <h4 class="mb-3">Select a Date:</h4>
                    <ng-container *ngIf="paginatedDates().length > 0">
                        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3 mb-4">
                            <div class="col" *ngFor="let date of paginatedDates()">
                                <div class="card date-card text-center p-3" [class.active]="isSelected(date)"
                                    (click)="selectDate(date)">
                                    <h5 class="card-title mb-0">{{ date | date: 'EEE' }}</h5>
                                    <p class="card-text text-muted mb-0">{{ date | date: 'fullDate' }}</p>
                                </div>
                            </div>
                        </div>
                        <!-- Pagination Controls for Dates -->
                        <nav aria-label="Dates Pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item" [class.disabled]="currentPage() === 1">
                                    <button class="page-link" (click)="previousPage()" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </button>
                                </li>
                                <li class="page-item" [class.active]="currentPage() === page" *ngFor="let page of getPages()">
                                    <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
                                </li>
                                <li class="page-item" [class.disabled]="currentPage() === totalPages()">
                                    <button class="page-link" (click)="nextPage()" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </button>
                                </li>
                            </ul>
                        </nav>
                    </ng-container>
                    <p class="text-center text-muted" *ngIf="paginatedDates().length === 0">No dates available for booking.</p>
                </ng-container>
                
                <!-- Time Slots Section -->
                <h4 class="mb-3 mt-5">Available Time Slots for
                    <span class="text-primary" *ngIf="selectedDate">{{ selectedDate | date: 'longDate' }}</span>
                    <span class="text-muted" *ngIf="!selectedDate">(Please select a date)</span>
                </h4>
                
                <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-2">
                    <div class="col" *ngFor="let slot of getSlotsForSelectedDate()">
                        <button class="btn time-slot-btn"
                            [ngClass]="{ 'btn-outline-primary': !CustomerHasThisAppointmentSlot(slot), 'btn-secondary': CustomerHasThisAppointmentSlot(slot) }"
                            [disabled]="CustomerHasThisAppointmentSlot(slot) || slot.isFull || !slot.isActive"
                            (click)="bookAppointment(slot)">
                            {{ slot.startTime | date: 'shortTime' }} - {{ slot.endTime | date: 'shortTime' }}
                            <span class="badge bg-danger ms-2" *ngIf="CustomerHasThisAppointmentSlot(slot)">Booked</span>
                            <span class="badge bg-success ms-2" *ngIf="!CustomerHasThisAppointmentSlot(slot)">Open</span>
                        </button>
                    </div>
                    <div class="col-12" *ngIf="getSlotsForSelectedDate().length === 0 && selectedDate">
                        <p class="text-center text-muted">No time slots available for this date.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for booking confirmation - kept as is -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bookingModalLabel">Confirm Your Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div *ngIf="typeof doctor !== 'string'" class="modal-body">
                <p>You are about to book an appointment with <strong>Dr. {{ doctor.fName }} {{ doctor.lName }}</strong>.</p>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Confirm Booking</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
